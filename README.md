# Google Calendar

## 1. Тема и целевая аудитория
__Google Calendar__ — сервис для планирования встреч, событий и дел.

### 1.1. Целевая аудитория
__MAU__ = __500__ млн. [[1]](https://explodingtopics.com/blog/google-workspace-stats), [[2]](https://zipdo.co/statistics/google-calendar/), [[4]](https://www.patronum.io/key-google-workspace-statistics-for-2023/)

Информация о __DAU__ отсутствует, поэтому примем его, равным __500 млн.__ пользователей, т.е. `MAU = DAU`. [[3]](https://marketsplash.com/google-workspace-statistics/)

### 1.2. Географическое распространение (данные за январь 2024) [[4]](https://www.similarweb.com/website/calendar.google.com/#geography)
| Страна         | Процент пользователей от общего числа, % | Количество, млн. |
| -------------- | :--------------------------------------: | :--------------: |
| США            |                  42,93                   |      214,65      |
| Япония         |                   8,17                   |      4,085       |
| Великобритания |                   3,68                   |       1,84       |
| Канада         |                   3,56                   |       1,78       |
| Франция        |                   3,43                   |      1,715       |
| Другие         |                  38,24                   |      191,2       |

### 1.3. Распространение среди различных возрастных групп (данные за январь 2024) [[4]](https://www.similarweb.com/website/calendar.google.com/#geography)
| Возрастная группа | Процент пользователей от общего числа, % |
| :---------------: | :--------------------------------------: |
|      18 - 24      |                  14,74                   |
|      25 - 34      |                  29,81                   |
|      35 - 44      |                  20,58                   |
|      45 - 54      |                  16,89                   |
|      55 - 64      |                  11,33                   |
|        65+        |                   6,65                   |

### 1.4. MVP
- Регистрация, авторизация;
- Создание, редактирование календарей;
- Каждый календарь можно сделать общедоступным либо предоставить отдельным людям доступ к нему (просмотр или редактирование) через приглашение по электронной почте;
- Уведомления о предстоящих событиях по почте;
- Создание и редактирование событий.


## 2. Расчёт нагрузки

### 2.1. Продуктовые метрики

#### 2.1.1. Хранилище пользователя
- Профиль:
    - email — 255B [[6]](https://emaillistvalidation.com/blog/demystifying-email-validation-understanding-the-maximum-length-of-email-addresses/#:~:text=Defining%20the%20Maximum%20Length&text=Domain%20Part%3A%20The%20domain%20part,email%20address%20is%20320%20characters.)
    - Хэшированный пароль — 72B [[7]](https://cheatsheetseries.owasp.org/cheatsheets/Password_Storage_Cheat_Sheet.html)
    - First name + Last name — 100B [[8]](https://www.geekslop.com/technology-articles/2016/here-are-the-recommended-maximum-data-length-limits-for-common-database-and-programming-fields#:~:text=35%20chars%20(US)%2C-,50%20(other),-Last%20name)
    - Часовой пояс — 12B (ссылка на часовой пояс в таблице часовых поясов) [[9]](https://www.postgresql.org/docs/8.2/datatype-datetime.html)
    - __Общий размер__: 255 + 72 + 100 + 8 = 435B
- Календари:
    - Примем количество личных календарей пользователя, равным 5
    - Название — 128 символов UTF-8 (128B)
    - Описание — 1024 символа UTF-8 (1024B)
    - Владелец — 8B (ссылка на пользователя)
    - Время создания — 12B
    - Время обновления — 12B
    - Размер одного календаря: 128 + 1024 + 8 + 12 + 12 = 1184B
    - __Общий размер__: 5 * 1184 = 5920B < 6KiB (принимаем размер хранилища в 6KiB)
- Подписки на календари:
    - Примем число подписок на чужие календари равным 5
    - Календарь — 8B (ссылка на календарь)
    - Подписчик — 8B (ссылка на пользователя)
    - __Общий размер__: 5 * (8 + 8) = 80B
- События:
    - Пусть пользователь создаёт в среднем 3 события в день (примем, что при общем числе событий в 1,5 млрд [[3]](https://marketsplash.com/google-workspace-statistics/) и DAU = 500 млн. число событий 1500/500 = 3). События хранятся долговременно
    - Тогда за период в 5 лет у пользователя наберётся в среднем: 3 * 365 * 5 = 5475 событий
    - Название — 128 символов UTF-8 (128B)
    - Описание — 4096+ символа UTF-8 (1024B)
    - Владелец — 8B (ссылка на пользователя)
    - Календарь — 8B (ссылка на календарь)
    - Время начала — 12B
    - Время окончания — 12B
    - Время создания — 12B
    - Время обновления — 12B
    - Размер одного события: 128 + 4096 + 8 + 8 + 12 + 12 + 12 + 12 = 4288B
    - __Общий размер__: 5475 * 4288 = 23476800B < 23.5MiB (принимаем размер хранилища в 23.5MiB)
- Подписки на события
    - Пример среднее число подписок на чужие события за период в 5 лет равным 2000 (5 * 365 = 1830 и округлим до 2000)
    - Событие — 8B (ссылка на событие)
    - Подписчик — 8B (ссылка на подписчика)
    - __Общий размер__: 2000 * (8 + 8) = 32000B < 32KiB (принимаем размер хранилища в 32KiB)
- Уведомления
    - Пусть уведомления хранятся в течение 1-го месяца [[10]](https://stackoverflow.com/questions/24138581/what-is-the-maximum-allowed-expiration-time-for-a-google-notification-channel)
    - Примем средее число уведомлений на событие равным 2-м (при создании и начале)
    - За месяц у пользователя происходит 3 * 30 = 90 своих событий и 5 * 3 * 30 = 450 (при 3-х событиях в 5 календарях, на которые пользователь подписан) тех, на которые он подписан
    - Тогда среднее количество уведомлений пользователя за месяц равно 2 * (90 + 450) = 1060
    - Размер информации уведомления примем ~ 1KiB
    - __Общий размер__: 1060 * 1 = 1060Kib = 1.06MiB

Хранилище под события и подписки на события рассчитано на период в 5 лет. Уведомления хранятся в среднем в течение 1-го месяца.

| Тип                   | Хранилище 1-го пользователя |
| --------------------- | :-------------------------: |
| Профиль               |            435B             |
| Календари             |            6KiB             |
| Подписки на календари |             80B             |
| События               |           23.5MiB           |
| Подписки на события   |            32KiB            |
| Уведомления           |           1.06MiB           |

#### 2.1.2 Среднее количество действий пользователя по типам в день

| Тип действия           |  Частота  |
| ---------------------- | :-------: |
| Просмотр календарей    | 15 / день |
| Создание события       | 3 / день  |
| Редактирование события | 1 / 2 дня |
| Получение уведомлений  | 15 / день |

### 2.2 Технические метрики

#### 2.2.1 Размер хранения в разбивке по типам данных

Так как количество зарегистрированных аккаунтов в Google Workspace равно 3 млрд [[1]](https://explodingtopics.com/blog/google-workspace-stats)-[[4]](https://www.patronum.io/key-google-workspace-statistics-for-2023/) и MAU Google Calendar равно 500 млн., то примем количество зарегистрированных пользователей равным 1 млрд.

Уведомления, события и подписки актуальны для активных пользователей, а профиль и календари есть у всех зарегистрированных.

- Округление выполняется в большую сторону
- Профиль: 435B * 1 млрд. = 406GiB
- Календари: 6KiB * 1 млрд. = 5.6TiB
- Подписки на календари: 80B * 500 млн. = 37.3GiB
- События: 23.5MiB * 500 млн. = 10.95PiB
- Подписки на события: 32KiB * 500 млн. = 14.9TiB
- Уведомления: 1.06MiB * 500 млн. = 506TiB

| Тип                   | Хранилище 1-го пользователя |
| --------------------- | :-------------------------: |
| События               |           10.95PiB          |
| Уведомления           |           506TiB            |
| Подписки на события   |           14.9TiB           |
| Календари             |           5.6TiB            |
| Профиль               |           406GiB            |
| Подписки на календари |           37.3GiB           |

#### 2.2.1 Сетевой трафик

- Средний RPS будем считать по следующей формуле:
    - _DAU * количество действий в день * количество запросов для действия / 86400 сек_
- Суммарный суточный трафик будем считать по следующей формуле:
    - _DAU * количество действий в день * количество байт пересылаемых запросами для совершения действия_
- Средний трафик будем считать по следующей формуле:
    - _Суммарный суточный трафик * 8 / 86400 сек_

## Список использованных источников
1. https://explodingtopics.com/blog/google-workspace-stats
2. https://zipdo.co/statistics/google-calendar/
3. https://marketsplash.com/google-workspace-statistics/
4. https://www.patronum.io/key-google-workspace-statistics-for-2023/
5. https://www.similarweb.com/website/calendar.google.com/#geography
6. https://emaillistvalidation.com/blog/demystifying-email-validation-understanding-the-maximum-length-of-email-addresses/#:~:text=Defining%20the%20Maximum%20Length&text=Domain%20Part%3A%20The%20domain%20part,email%20address%20is%20320%20characters.
7. https://cheatsheetseries.owasp.org/cheatsheets/Password_Storage_Cheat_Sheet.html
8. https://www.geekslop.com/technology-articles/2016/here-are-the-recommended-maximum-data-length-limits-for-common-database-and-programming-fields#:~:text=35%20chars%20(US)%2C-,50%20(other),-Last%20name
9. https://www.postgresql.org/docs/8.2/datatype-datetime.html
10. https://stackoverflow.com/questions/24138581/what-is-the-maximum-allowed-expiration-time-for-a-google-notification-channel
